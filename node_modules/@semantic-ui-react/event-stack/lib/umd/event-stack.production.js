!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.EventStack=t()}(this,function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a,s=(function(e){var t,n;t=!("undefined"==typeof window||!window.document||!window.document.createElement),n={canUseDOM:t,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:t&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:t&&!!window.screen},e.exports?e.exports=n:window.ExecutionEnvironment=n}(a={exports:{}},a.exports),a.exports).canUseDOM,i=function(){function t(n){e(this,t),r(this,"handlers",void 0),this.handlers=n.slice(0)}return n(t,[{key:"addHandlers",value:function(e){for(var n=this.handlers.slice(0),r=e.length,a=0;a<r;a+=1)n.push(e[a]);return new t(n)}},{key:"dispatchEvent",value:function(e,t){var n=this.handlers.length-1;if(t){for(var r=n;r>=0;r-=1)this.handlers[r].called||(this.handlers[r].called=!0,this.handlers[r](e));for(var a=n;a>=0;a-=1)this.handlers[a].called=!1}else{(0,this.handlers[n])(e)}}},{key:"hasHandlers",value:function(){return this.handlers.length>0}},{key:"removeHandlers",value:function(e){for(var n=[],r=this.handlers.length,a=0;a<r;a+=1){var s=this.handlers[a];-1===e.indexOf(s)&&n.push(s)}return new t(n)}}]),t}();function o(e){var t=new Map;return e.forEach(function(e,n){t.set(n,e)}),t}function d(e){return Array.isArray(e)?e:[e]}function l(e){return"document"===e?document:"window"===e?window:e||document}var h=function(){function t(n,a){e(this,t),r(this,"handlerSets",void 0),r(this,"poolName",void 0),this.handlerSets=a,this.poolName=n}return n(t,[{key:"addHandlers",value:function(e,n){var r=o(this.handlerSets);if(r.has(e)){var a=r.get(e);r.set(e,a.addHandlers(n))}else r.set(e,new i(n));return new t(this.poolName,r)}},{key:"dispatchEvent",value:function(e,t){var n=this.handlerSets.get(e),r="default"===this.poolName;n&&n.dispatchEvent(t,r)}},{key:"hasHandlers",value:function(){return this.handlerSets.size>0}},{key:"removeHandlers",value:function(e,n){var r=o(this.handlerSets);if(!r.has(e))return new t(this.poolName,r);var a=r.get(e).removeHandlers(n);return a.hasHandlers()?r.set(e,a):r.delete(e),new t(this.poolName,r)}}]),t}();r(h,"createByType",function(e,t,n){var r=new Map;return r.set(t,new i(n)),new h(e,r)});var u=function(){function t(n){e(this,t),r(this,"handlers",new Map),r(this,"pools",new Map),r(this,"target",void 0),r(this,"createEmitter",function(e,t){return function(n){t.forEach(function(t){t.dispatchEvent(e,n)})}}),this.target=n}return n(t,[{key:"addHandlers",value:function(e,t,n){if(this.removeTargetHandler(t),this.pools.has(e)){var r=this.pools.get(e);this.pools.set(e,r.addHandlers(t,n))}else this.pools.set(e,h.createByType(e,t,n));this.addTargetHandler(t)}},{key:"hasHandlers",value:function(){return this.handlers.size>0}},{key:"removeHandlers",value:function(e,t,n){if(this.pools.has(e)){var r=this.pools.get(e).removeHandlers(t,n);r.hasHandlers()?this.pools.set(e,r):this.pools.delete(e),this.removeTargetHandler(t),this.pools.size>0&&this.addTargetHandler(t)}}},{key:"addTargetHandler",value:function(e){var t=this.createEmitter(e,this.pools);this.handlers.set(e,t),this.target.addEventListener(e,t)}},{key:"removeTargetHandler",value:function(e){this.handlers.has(e)&&(this.target.removeEventListener(e,this.handlers.get(e)),this.handlers.delete(e))}}]),t}();return new(function(){function t(){var n=this;e(this,t),r(this,"targets",new Map),r(this,"getTarget",function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=l(e);if(n.targets.has(r))return n.targets.get(r);if(!t)return null;var a=new u(r);return n.targets.set(r,a),a}),r(this,"removeTarget",function(e){n.targets.delete(l(e))})}return n(t,[{key:"sub",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(s){var r=n.target,a=void 0===r?document:r,i=n.pool,o=void 0===i?"default":i;this.getTarget(a).addHandlers(o,e,d(t))}}},{key:"unsub",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(s){var r=n.target,a=void 0===r?document:r,i=n.pool,o=void 0===i?"default":i,l=this.getTarget(a,!1);l&&(l.removeHandlers(o,e,d(t)),l.hasHandlers()||this.removeTarget(a))}}}]),t}())});
